Você é um(a) DevOps sênior. Instrumente logs estruturados (JSON) no backend FastAPI em `app_v1` e integre-os ao OpenSearch (com Dashboards) via `docker-compose`.

Contexto do projeto:
- Raiz: `app_v1/`
- Backend: FastAPI em `app_v1/backend/main.py` (SQLAlchemy + Postgres, cria tabelas em startup, expõe `/metrics`)
- Frontend: Streamlit em `app_v1/frontend/app.py`
- Compose atual: `db`, `backend`, `frontend`, `prometheus`, `postgres-exporter`
- Baseie-se apenas em `app_v1/` (padrões: imagens slim, não-root, bind mounts, validação PowerShell)

Objetivo:
- Emitir logs JSON no stdout do backend (incluindo access logs HTTP) com campos padronizados
- Enviar logs para um índice no OpenSearch (`logs-app-v1`)
- Provisionar `opensearch` e `opensearch-dashboards` no compose

Boas práticas (didáticas):
- Formato único para `root`, `uvicorn`, `uvicorn.access`, `fastapi`, `sqlalchemy.engine`
- Campos mínimos: `timestamp` (UTC ISO), `level`, `logger`, `message`, `request_id`, `method`, `path`, `status_code`, `duration_ms`, `client_ip`, `user_agent`
- Handler OpenSearch não-bloqueante (retry/backoff leve; fallback stdout)
- Evitar PII/segredos; usar níveis adequados

Tarefas (caminhos relativos a `app_v1`):
1) Dependências
	 - Em `requirements.txt`, adicionar: `python-json-logger`, `opensearch-py` (opcional: `uvicorn[standard]`).

2) Logging JSON no backend
	 - Criar `backend/logging_conf.py` com:
		 - Formatter JSON (python-json-logger) com os campos acima.
		 - `OpenSearchHandler` (subclasse `logging.Handler`) lendo envs `OPENSEARCH_ENABLED`, `OPENSEARCH_HOST`, `OPENSEARCH_PORT`, `OPENSEARCH_SCHEME`, `OPENSEARCH_USER`, `OPENSEARCH_PASSWORD`, `OPENSEARCH_INDEX` (padrão `logs-app-v1`), envio em bulk com retry leve e fallback stdout.
		 - `setup_logging()` aplicando o formatter ao root e aos loggers `uvicorn`, `uvicorn.access`, `fastapi`, `sqlalchemy.engine`.

3) Middleware de correlação
	 - Criar `backend/middleware.py` para:
		 - Gerar/propagar `request_id` (cabeçalho `X-Request-ID`).
		 - Medir `duration_ms` e coletar `client_ip`/`user_agent`.
		 - Logar acesso (`INFO`) ao final: `method`, `path`, `status_code`, `duration_ms`, `request_id`, `client_ip`, `user_agent`.
		 - Em exceções, usar `logger.exception` sem alterar respostas.

4) Integração no FastAPI
	 - Em `backend/main.py`: importar e chamar `setup_logging()` antes de instanciar `FastAPI`.
	 - Adicionar o middleware de correlação após criar o app.
	 - Manter CORS e rotas inalterados; manter access logs do Uvicorn.

5) OpenSearch no docker-compose
	 - Em `docker-compose.yml`, adicionar serviços:
		 - `opensearch` (image `opensearchproject/opensearch:2`)
			 - env: `discovery.type=single-node`, `plugins.security.disabled=true`, `OPENSEARCH_JAVA_OPTS=-Xms512m -Xmx512m`.
			 - ports: `9200:9200`, `9600:9600`.
		 - `opensearch-dashboards` (image `opensearchproject/opensearch-dashboards:2`)
			 - env: `OPENSEARCH_HOSTS=['http://opensearch:9200']`.
			 - ports: `5601:5601`.
			 - depends_on: `opensearch`.
	 - No serviço `backend`, adicionar envs:
		 - `OPENSEARCH_ENABLED=true`, `OPENSEARCH_HOST=opensearch`, `OPENSEARCH_PORT=9200`, `OPENSEARCH_SCHEME=http`, `OPENSEARCH_USER=`, `OPENSEARCH_PASSWORD=`, `OPENSEARCH_INDEX=logs-app-v1`.
	 - `backend` depende de `opensearch` (service_started).

6) Validação (Windows PowerShell)
	 - Rebuild/subida:
		 - `docker compose build`
		 - `docker compose up -d`
	 - UIs: `http://localhost:9200` e `http://localhost:5601` → 200.
	 - Tráfego no backend: `GET http://localhost:8000/items` e `POST /items`.
	 - Logs JSON no stdout: `docker compose logs -f backend` (verificar campos).
	 - OpenSearch:
		 - `GET http://localhost:9200/logs-app-v1/_count`
		 - `GET http://localhost:9200/logs-app-v1/_search?q=path:%2Fitems&size=5`.

7) Atualizar `README.md`
	 - Descrever formato de logs, variáveis `OPENSEARCH_*`, acesso a OpenSearch/Dashboards e consultas de exemplo; boas práticas.

Critérios de aceite
- `python-json-logger` e `opensearch-py` no `requirements.txt`.
- Backend emite logs JSON com campos definidos e permanece funcional.
- Logs enviados ao índice `logs-app-v1` (verificados via `_count`/`_search` e Dashboards).
- Serviços `opensearch` (9200) e `opensearch-dashboards` (5601) no compose e acessíveis.

Observações de segurança
- Segurança desabilitada apenas para laboratório; em produção usar auth/TLS/rede privada.
- Evitar PII/segredos; definir níveis/retention; considerar shipper (Fluent Bit/Vector) em produção.
